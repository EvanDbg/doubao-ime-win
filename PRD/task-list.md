# Doubao Voice Input - Development Task List（简化版）

## 项目概览
纯语音输入工具开发任务清单（已大幅简化）

---

## Phase 1: 项目初始化与基础框架（2 周）
- [ ] 初始化 Rust 项目
- [ ] 配置 Cargo.toml（依赖管理）
- [ ] 设置日志系统（tracing）
- [ ] 创建项目目录结构
- [ ] 实现全局热键监听（global-hotkey）
- [ ] 实现系统托盘图标与菜单
- [ ] 测试热键注册与托盘功能

---

## Phase 2: 语音识别集成（2 周）
- [ ] 移植 doubaoime-asr 协议到 Rust
  - [ ] 实现设备注册
  - [ ] 实现 HTTP 客户端
  - [ ] 实现 WebSocket 客户端
- [ ] 解析 ASR 响应（INTERIM_RESULT, FINAL_RESULT）
- [ ] 实现音频采集（cpal）
- [ ] 实现 PCM 音频重采样（rubato）
- [ ] 实现实时语音识别流程
- [ ] 测试 ASR 端到端流程

---

## Phase 3: 文本插入与 UI（2 周）
- [ ] 实现 Windows SendInput 文本插入
  - [ ] Unicode 字符插入
  - [ ] 退格键删除（用于流式修正）
- [ ] 测试文本插入兼容性（记事本、Word、浏览器）
- [ ] 实现悬浮按钮 UI
  - [ ] 设计悬浮按钮样式（圆形、渐变）
  - [ ] 实现拖动功能
  - [ ] 实现点击切换录音状态
  - [ ] 录音时动画效果
- [ ] 实现设置界面
  - [ ] 热键配置（组合键/双击模式）
  - [ ] 悬浮按钮开关

---

## Phase 4: 配置与凭据管理（1 周）
- [ ] 实现配置文件解析（config.toml）
- [ ] 实现凭据加密存储（Windows DPAPI）
- [ ] 实现设备自动注册
- [ ] 实现配置持久化
- [ ] 测试配置加载与保存

---

## Phase 5: 打包与测试（1 周）
- [ ] 配置 Release 构建优化
- [ ] 编写绿色打包脚本（PowerShell）
- [ ] 静态链接所有依赖
- [ ] 集成测试
  - [ ] 热键功能测试
  - [ ] 悬浮按钮测试
  - [ ] 文本插入测试（多应用）
  - [ ] 语音识别测试
- [ ] 性能测试
  - [ ] 内存占用（目标 < 100MB）
  - [ ] CPU 使用率
  - [ ] 启动速度（目标 < 2s）
- [ ] 兼容性测试（Windows 10/11）

---

## Phase 6: 文档与发布（1 周）
- [ ] 编写用户使用指南
- [ ] 录制演示视频
- [ ] 创建 GitHub Releases
- [ ] 发布 v1.0.0 版本

---

## 技术风险评估（简化版）

| 风险项 | 风险等级 | 缓解措施 | 状态 |
|--------|----------|----------|------|
| SendInput 兼容性问题 | 中 | 测试主流应用，提供降级方案 | 🟡 待验证 |
| 豆包 ASR 协议变更 | 中 | 协议版本检测，日志记录 | 🟡 待验证 |
| 全局热键冲突 | 低 | 允许用户自定义 | 🟢 可控 |
| 音频设备兼容性 | 低 | 使用 cpal 默认设备，提供设备选择 | 🟢 可控 |

---

## 当前状态
**Phase**: 需求分析与文档编写  
**完成**: 0/6 阶段  
**总预计时间**: 7 周（相比原计划减少 4 周）  
**Blockers**: 无

---

## 与原计划对比

### 移除阶段
- ❌ Phase 2: Windows TSF Integration（4 周）
- ❌ Phase 3: Candidate Window UI（原独立阶段，已简化到 UI 阶段）

### 新增/调整阶段
- ✅ Phase 1: 增加悬浮按钮功能
- ✅ Phase 3: 合并 UI 开发（悬浮按钮 + 识别窗口 + 设置）
- ✅ Phase 4: 简化配置管理

### 时间节省
| 项目 | 原计划 | 简化版 | 节省 |
|------|--------|--------|------|
| 总时间 | 11 周 | 7 周 | 4 周 (-36%) |
| 核心模块 | 15+ | 8 | 7 个模块 |

---

**最后更新**: 2026-02-05
